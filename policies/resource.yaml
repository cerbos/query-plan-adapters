# yaml-language-server: $schema=https://api.cerbos.dev/latest/cerbos/policy/v1/Policy.schema.json

apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: default
  resource: resource
  rules:
    - actions:
        - "always-allow"
      effect: EFFECT_ALLOW
      roles:
        - USER

    - actions:
        - "always-deny"
      effect: EFFECT_DENY
      roles:
        - USER

    - actions:
        - "equal"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aBool == true

    - actions:
        - "explicit-deny"
      effect: EFFECT_DENY
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aBool == true

    - actions:
        - "explicit-deny"
      effect: EFFECT_ALLOW
      roles:
        - USER

    - actions:
        - "ne"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aString != "string"

    - actions:
        - "and"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.aBool == true
              - expr: request.resource.attr.aString != "string"

    - actions:
        - "or"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          any:
            of:
              - expr: request.resource.attr.aBool == true
              - expr: request.resource.attr.aString != "string"

    - actions:
        - "nand"
      effect: EFFECT_DENY
      roles:
        - USER
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.aBool == true
              - expr: request.resource.attr.aString != "string"

    - actions:
        - "nor"
      effect: EFFECT_DENY
      roles:
        - USER
      condition:
        match:
          any:
            of:
              - expr: request.resource.attr.aBool == true
              - expr: request.resource.attr.aString != "string"

    - actions:
        - "in"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aString in ["string", "anotherString"]

    - actions:
        - "gt"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aNumber > 1

    - actions:
        - "lt"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aNumber < 2

    - actions:
        - "gte"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aNumber >= 1

    - actions:
        - "lte"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aNumber <= 2

    - actions:
        - "relation-some"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: P.id in request.resource.attr.ownedBy

    - actions:
        - "relation-none"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: >
            !(P.id in request.resource.attr.ownedBy)

    - actions:
        - "relation-is"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.createdBy == P.id

    - actions:
        - "relation-is-not"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: >
            !(request.resource.attr.createdBy == P.id)

    - actions:
        - "equal-nested"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aBool == true

    - actions:
        - "relation-eq-number"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aNumber == 1

    - actions:
        - "relation-lt-number"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aNumber < 2

    - actions:
        - "relation-lte-number"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aNumber <= 2

    - actions:
        - "relation-gte-number"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aNumber >= 1

    - actions:
        - "has-tag"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: >
            "public" in request.resource.attr.tags

    - actions:
        - "has-no-tag"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: >
            !("private" in request.resource.attr.tags)

    - actions:
        - "relation-gt-number"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.nested.aNumber > 1

    - actions:
        - "relation-multiple-all"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          all:
            of:
              - expr: request.resource.attr.nested.aNumber > 1
              - expr: request.resource.attr.nested.aNumber < 3

    - actions:
        - "relation-multiple-or"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          any:
            of:
              - expr: request.resource.attr.createdBy == P.id
              - expr: P.id in request.resource.attr.ownedBy

    - actions:
        - "relation-multiple-none"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          none:
            of:
              - expr: request.resource.attr.createdBy == P.id
              - expr: >
                  "public" in request.resource.attr.tags

    - actions:
        - "contains"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aString.contains("str")

    - actions:
        - "starts-with"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aString.startsWith("str")

    - actions:
        - "is-set"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: request.resource.attr.aOptionalString != null

    - actions:
        - "has-intersection"
      effect: EFFECT_ALLOW
      roles:
        - USER
      condition:
        match:
          expr: hasIntersection(request.resource.attr.tags, request.principal.attr.tags)
